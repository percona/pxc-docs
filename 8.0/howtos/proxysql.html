



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation">
      
      
        <meta name="author" content="Percona LLC">
      
      
        <link rel="canonical" href="https://docs.percona.com/percona-xtradb-cluster-docs/8.0/8.0/howtos/proxysql.html">
      
      
        <link rel="prev" href="haproxy.html">
      
      
        <link rel="next" href="proxysql-v2.html">
      
      <link rel="icon" href="../_static/percona-favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.2">
    
    
      
        <title>Load balancing with ProxySQL - Percona XtraDB Cluster</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7bf56d0a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Poppins";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unicons.iconscout.com/release/v3.0.3/css/line.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="../css/percona.css">
    
      <link rel="stylesheet" href="../css/nocopy.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-343802-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");ga("send","event","feedback","click",t,e),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){ga("send","pageview",e.pathname)})});var e=document.createElement("script");e.async=!0,e.src="https://www.google-analytics.com/analytics.js",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
              

              <script>
              (function (w, d, s, l, i) {
                  w[l] = w[l] || []; w[l].push({
                    'gtm.start': new Date().getTime(), 
                    event: 'gtm.js'
                  });
                  var f = d.getElementsByTagName(s)[0],
                  j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
                  j.async = true; 
                  j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
                  f.parentNode.insertBefore(j, f);
                })(window, document, 'script', 'dataLayer', 'GTM-K48FGP2');
              </script>
              
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="percona-light" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#load-balancing-with-proxysql" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://docs.percona.com" title="Percona XtraDB Cluster" class="md-header__button md-logo" aria-label="Percona XtraDB Cluster" data-md-component="logo">
      
  <img src="../_static/percona-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Percona XtraDB Cluster
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Load balancing with ProxySQL
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="percona-light" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/percona/pxc-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    percona/pxc-docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://docs.percona.com" title="Percona XtraDB Cluster" class="md-nav__button md-logo" aria-label="Percona XtraDB Cluster" data-md-component="logo">
      
  <img src="../_static/percona-logo.svg" alt="logo">

    </a>
    Percona XtraDB Cluster
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/percona/pxc-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    percona/pxc-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro.html" class="md-nav__link">
        About Percona XtraDB Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../limitation.html" class="md-nav__link">
        Percona XtraDB Cluster limitations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../xtradb-cluster-version-numbers.html" class="md-nav__link">
        Understand version numbers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Get started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Get started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview.html" class="md-nav__link">
        Quick start guide for Percona XtraDB Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/index.html" class="md-nav__link">
        Install Percona XtraDB Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configure.html" class="md-nav__link">
        Configure nodes for write-set replication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bootstrap.html" class="md-nav__link">
        Bootstrap the first node
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../add-node.html" class="md-nav__link">
        Add nodes to cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../verify.html" class="md-nav__link">
        Verify replication
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../features/highavailability.html" class="md-nav__link">
        High availability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../features/pxc-strict-mode.html" class="md-nav__link">
        PXC strict mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../features/online-schema-upgrade.html" class="md-nav__link">
        Online schema upgrade
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../features/nbo.html" class="md-nav__link">
        Non-Blocking Operations (NBO) method for Online Scheme Upgrades (OSU)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          PXC security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          PXC security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/index.html" class="md-nav__link">
        Security basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/secure-network.html" class="md-nav__link">
        Secure the network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/encrypt-traffic.html" class="md-nav__link">
        Encrypt PXC traffic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/apparmor.html" class="md-nav__link">
        Enable AppArmor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/selinux.html" class="md-nav__link">
        Enable SELinux
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          User's manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          User's manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/state_snapshot_transfer.html" class="md-nav__link">
        State snapshot transfer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/xtrabackup_sst.html" class="md-nav__link">
        Percona XtraBackup SST configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/restarting_nodes.html" class="md-nav__link">
        Restart the cluster nodes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/failover.html" class="md-nav__link">
        Cluster failover
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/monitoring.html" class="md-nav__link">
        Monitor the cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/certification.html" class="md-nav__link">
        Certification in Percona XtraDB Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/threading_model.html" class="md-nav__link">
        Percona XtraDB Cluster threading model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/gcache_record-set_cache_difference.html" class="md-nav__link">
        Understand GCache and Record-Set cache
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../management/gcache-write-set-cache-encryption.html" class="md-nav__link">
        GCache encryption and Write-Set cache encryption
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manual/performance_schema_instrumentation.html" class="md-nav__link">
        Perfomance Schema instrumentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../management/data_at_rest_encryption.html" class="md-nav__link">
        Data at Rest Encryption
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          How-tos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          How-tos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="upgrade_guide.html" class="md-nav__link">
        Upgrade Percona XtraDB Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="crash-recovery.html" class="md-nav__link">
        Crash recovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="centos_howto.html" class="md-nav__link">
        Configure Percona XtraDB Cluster on CentOS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ubuntu_howto.html" class="md-nav__link">
        Configure Percona XtraDB Cluster on Ubuntu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="garbd_howto.html" class="md-nav__link">
        Set up Galera arbitrator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="singlebox.html" class="md-nav__link">
        How to set up a three-node cluster on a single box
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="3nodesec2.html" class="md-nav__link">
        How to set up a three-node cluster in EC2 environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="haproxy.html" class="md-nav__link">
        Load balancing with HAProxy
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Load balancing with ProxySQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="proxysql.html" class="md-nav__link md-nav__link--active">
        Load balancing with ProxySQL
      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#manual-configuration" class="md-nav__link">
    Manual configuration
  </a>
  
    <nav class="md-nav" aria-label="Manual configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-cluster-nodes-to-proxysql" class="md-nav__link">
    Add cluster nodes to ProxySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-proxysql-monitoring-user" class="md-nav__link">
    Create ProxySQL monitoring user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-proxysql-client-user" class="md-nav__link">
    Create ProxySQL client user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-cluster-with-sysbench" class="md-nav__link">
    Test cluster with sysbench
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-failover" class="md-nav__link">
    Automatic failover
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assisted-maintenance-mode" class="md-nav__link">
    Assisted maintenance mode
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="proxysql-v2.html" class="md-nav__link">
        ProxySQL admin utilities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="virt_sandbox.html" class="md-nav__link">
        Setting up a testing environment with ProxySQL
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Release notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Release notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/release-notes_index.html" class="md-nav__link">
        Release notes index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/8.0.31-23.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.31-23 (2023-03-14)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/8.0.30-22.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.30-22.md (2022-12-28)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/8.0.29-21.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.29-21 (2022-09-12)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.28-19.1.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.28-19.1 (2022-07-19)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.27-18.1.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.27-18.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.26-16.1.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.26-16.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.25-15.1.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.25-15.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.23-14.1.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.23-14.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.22-13.1.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.22-13.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.21-12.1.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.21-12.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.20-11.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.20-11
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.20-11.3.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.20-11.3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.20-11.2.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.20-11.2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.19-10.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.19-10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/Percona-XtraDB-Cluster-8.0.18-9.3.html" class="md-nav__link">
        Percona XtraDB Cluster 8.0.18-9.3
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          References
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          References
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wsrep-status-index.html" class="md-nav__link">
        Index of wsrep status variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wsrep-system-index.html" class="md-nav__link">
        Index of wsrep system variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wsrep-provider-index.html" class="md-nav__link">
        Index of wsrep_provider options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wsrep-files-index.html" class="md-nav__link">
        Index of files created by PXC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faq.html" class="md-nav__link">
        Frequently asked questions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../glossary.html" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../copyright-and-licensing-information.html" class="md-nav__link">
        Copyright and licensing information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trademark-policy.html" class="md-nav__link">
        Trademark policy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
    <br/>
   <label class="md-nav__title" for="__drawer">
    <a href="https://learn.percona.com/download-percona-xtradb-cluster-8-manual" onclick="_gaq.push(['b._trackEvent', 'Percona XtraBackup', 'Download', 'Download Manual Percona XtraBackup']);" class="md-nav__link md-nav__link--active">
      Download PDF
    </a>
  </label> 
  </ul>
</nav>

                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#manual-configuration" class="md-nav__link">
    Manual configuration
  </a>
  
    <nav class="md-nav" aria-label="Manual configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-cluster-nodes-to-proxysql" class="md-nav__link">
    Add cluster nodes to ProxySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-proxysql-monitoring-user" class="md-nav__link">
    Create ProxySQL monitoring user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-proxysql-client-user" class="md-nav__link">
    Create ProxySQL client user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-cluster-with-sysbench" class="md-nav__link">
    Test cluster with sysbench
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-failover" class="md-nav__link">
    Automatic failover
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assisted-maintenance-mode" class="md-nav__link">
    Assisted maintenance mode
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

                <!-- Edit and view button -->
                
                  
                  
                  <a
                    href="https://github.com/percona/pxc-docs/edit/8.0/docs/howtos/proxysql.md"
                    title=""
                    class="md-content__button md-icon"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
                  </a>
                  <a
                    href="https://raw.githubusercontent.com/percona/pxc-docs/8.0/docs/howtos/proxysql.md"
                    title="View source of this page"
                    class="md-content__button md-icon"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
                  </a>
                

                <!--
                  Hack: check whether the content contains a h1 headline. If it
                  doesn't, the page title (or respectively site name) is used
                  as the main headline.
                -->
                

                <!-- Markdown content -->
                <h1 id="load-balancing-with-proxysql">Load balancing with ProxySQL<a class="headerlink" href="#load-balancing-with-proxysql" title="Permanent link">&para;</a></h1>
<p><a href="http://www.proxysql.com/">ProxySQL</a> is a high-performance SQL proxy. ProxySQL runs as a daemon watched by
a monitoring process. The process monitors the daemon and restarts it in case
of a crash to minimize downtime.</p>
<p>The daemon accepts incoming traffic from MySQL clients and forwards it to
backend MySQL servers.</p>
<p>The proxy is designed to run continuously without needing to be restarted.  Most
configuration can be done at runtime using queries similar to SQL statements in
the ProxySQL admin interface.  These include runtime parameters, server
grouping, and traffic-related settings.</p>
<div class="admonition admonition">
<p class="admonition-title">See also</p>
<p><a href="https://proxysql.com/documentation/">ProxySQL Documentation</a></p>
</div>
<p><a href="proxysql-v2.html#pxc-proxysql-v2">ProxySQL v2</a> natively supports Percona XtraDB Cluster. With this version,
<code>proxysql-admin</code> tool does not require any custom scripts to keep track of Percona XtraDB Cluster status.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In version 8.0, Percona XtraDB Cluster does not support ProxySQL v1.  </p>
</div>
<h2 id="manual-configuration">Manual configuration<a class="headerlink" href="#manual-configuration" title="Permanent link">&para;</a></h2>
<p>This section describes how to configure ProxySQL with three Percona XtraDB Cluster nodes.</p>
<table>
<thead>
<tr>
<th>Node</th>
<th>Host Name</th>
<th>IP address</th>
</tr>
</thead>
<tbody>
<tr>
<td>Node 1</td>
<td>pxc1</td>
<td>192.168.70.71</td>
</tr>
<tr>
<td>Node 2</td>
<td>pxc2</td>
<td>192.168.70.72</td>
</tr>
<tr>
<td>Node 3</td>
<td>pxc3</td>
<td>192.168.70.73</td>
</tr>
<tr>
<td>Node 4</td>
<td>proxysql</td>
<td>192.168.70.74</td>
</tr>
</tbody>
</table>
<p>ProxySQL can be configured either using the <code>/etc/proxysql.cnf</code> file or
through the admin interface. The admin interface is recommended because this interface can dynamically change the configuration without restarting the proxy.</p>
<p>To connect to the ProxySQL admin interface, you need a <code>mysql</code> client.
You can either connect to the admin interface from Percona XtraDB Cluster nodes
that already have the <code>mysql</code> client installed (Node 1, Node 2, Node 3)
or install the client on Node 4 and connect locally.
For this tutorial, install Percona XtraDB Cluster on Node 4:</p>
<p><strong>Changes in the installation procedure</strong></p>
<p>In Percona XtraDB Cluster 8.0, ProxySQL is not installed automatically as a dependency of the <code>percona-xtradb-cluster-client-8.0</code> package. You should install the <code>proxysql</code> package separately.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ProxySQL has multiple versions in the version 2 series.</p>
</div>
<ul>
<li>On Debian or Ubuntu for ProxySQL 2.x:</li>
</ul>
<div class="highlight" data-prompt="root@proxysql:~#"><pre><span></span><code>root@proxysql:~#<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>percona-xtradb-cluster-client
root@proxysql:~#<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>proxysql2
</code></pre></div>
<ul>
<li>On Red Hat Enterprise Linux or CentOS for ProxySQL 2.x:</li>
</ul>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>Percona-XtraDB-Cluster-client-80
$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>proxysql2
</code></pre></div>
<p>To connect to the admin interface, use the credentials, host name and port specified in the <a href="https://github.com/sysown/proxysql/blob/master/doc/global_variables.md">global variables</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not use default credentials in production!</p>
</div>
<p>The following example shows how to connect to the ProxySQL admin interface
with default credentials:</p>
<div class="highlight" data-prompt="root@proxysql:~#"><pre><span></span><code>root@proxysql:~#<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>admin<span class="w"> </span>-padmin<span class="w"> </span>-h<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>-P<span class="w"> </span><span class="m">6032</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.5.30 (ProxySQL Admin Module)

Copyright (c) 2009-2020 Percona LLC and/or its affiliates
Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

mysql@proxysql&gt;
</code></pre></div>
</details>
<p>To see the ProxySQL databases and tables use the following commands:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>SHOW<span class="w"> </span>DATABASES<span class="p">;</span>
</code></pre></div>
<p>The following output shows the ProxySQL databases:</p>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+-----+---------+-------------------------------+
| seq | name    | file                          |
+-----+---------+-------------------------------+
| 0   | main    |                               |
| 2   | disk    | /var/lib/proxysql/proxysql.db |
| 3   | stats   |                               |
| 4   | monitor |                               |
+-----+---------+-------------------------------+
4 rows in set (0.00 sec)
</code></pre></div>
</details>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>SHOW<span class="w"> </span>TABLES<span class="p">;</span>
</code></pre></div>
<p>The following output shows the ProxySQL tables:</p>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+--------------------------------------+
| tables                               |
+--------------------------------------+
| global_variables                     |
| mysql_collations                     |
| mysql_query_rules                    |
| mysql_replication_hostgroups         |
| mysql_servers                        |
| mysql_users                          |
| runtime_global_variables             |
| runtime_mysql_query_rules            |
| runtime_mysql_replication_hostgroups |
| runtime_mysql_servers                |
| runtime_scheduler                    |
| scheduler                            |
+--------------------------------------+
12 rows in set (0.00 sec)
</code></pre></div>
</details>
<p>For more information about admin databases and tables,
see <a href="https://github.com/sysown/proxysql/blob/master/doc/admin_tables.md">Admin Tables</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The ProxySQL configuration can reside in the following areas:</p>
<ul>
<li>
<p>MEMORY (your current working place)</p>
</li>
<li>
<p>RUNTIME (the production settings)</p>
</li>
<li>
<p>DISK (durable configuration, saved inside an SQLITE database)</p>
</li>
</ul>
<p>When you change a parameter, you change it in MEMORY area.
This ability is by design and lets you test the changes
before pushing the change to production (RUNTIME), or save the change to disk.</p>
</div>
<h3 id="add-cluster-nodes-to-proxysql">Add cluster nodes to ProxySQL<a class="headerlink" href="#add-cluster-nodes-to-proxysql" title="Permanent link">&para;</a></h3>
<p>To configure the backend Percona XtraDB Cluster nodes in ProxySQL,
insert corresponding records into the <code>mysql_servers</code> table.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ProxySQL uses the concept of <em>hostgroups</em> to group cluster nodes.
This enables you to balance the load in a cluster by
routing different types of traffic to different groups.
There are many ways you can configure hostgroups
(for example, source and replicas, read and write load, etc.)
and a every node can be a member of multiple hostgroups.</p>
</div>
<p>This example adds three Percona XtraDB Cluster nodes to the default hostgroup (<code>0</code>),
which receives both write and read traffic:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>mysql_servers<span class="o">(</span>hostgroup_id,<span class="w"> </span>hostname,<span class="w"> </span>port<span class="o">)</span><span class="w"> </span>VALUES<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="s1">&#39;192.168.70.71&#39;</span>,3306<span class="o">)</span><span class="p">;</span>
mysql@proxysql&gt;<span class="w"> </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>mysql_servers<span class="o">(</span>hostgroup_id,<span class="w"> </span>hostname,<span class="w"> </span>port<span class="o">)</span><span class="w"> </span>VALUES<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="s1">&#39;192.168.70.72&#39;</span>,3306<span class="o">)</span><span class="p">;</span>
mysql@proxysql&gt;<span class="w"> </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>mysql_servers<span class="o">(</span>hostgroup_id,<span class="w"> </span>hostname,<span class="w"> </span>port<span class="o">)</span><span class="w"> </span>VALUES<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="s1">&#39;192.168.70.73&#39;</span>,3306<span class="o">)</span><span class="p">;</span>
</code></pre></div>
<p>To see the nodes:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>mysql_servers<span class="p">;</span>
</code></pre></div>
<p>The following output shows the list of nodes:</p>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+--------------+---------------+------+--------+--------+-------------+-----------------+---------------------+---------+----------------+---------+
| hostgroup_id | hostname      | port | status | weight | compression | max_connections | max_replication_lag | use_ssl | max_latency_ms | comment |
+--------------+---------------+------+--------+--------+-------------+-----------------+---------------------+---------+----------------+---------+
| 0            | 192.168.70.71 | 3306 | ONLINE | 1      | 0           | 1000            | 0                   | 0       | 0              |         |
| 0            | 192.168.70.72 | 3306 | ONLINE | 1      | 0           | 1000            | 0                   | 0       | 0              |         |
| 0            | 192.168.70.73 | 3306 | ONLINE | 1      | 0           | 1000            | 0                   | 0       | 0              |         |
+--------------+---------------+------+--------+--------+-------------+-----------------+---------------------+---------+----------------+---------+
3 rows in set (0.00 sec)
</code></pre></div>
</details>
<h3 id="create-proxysql-monitoring-user">Create ProxySQL monitoring user<a class="headerlink" href="#create-proxysql-monitoring-user" title="Permanent link">&para;</a></h3>
<p>To enable monitoring of Percona XtraDB Cluster nodes in ProxySQL,
create a user with <code>USAGE</code> privilege on any node in the cluster
and configure the user in ProxySQL.</p>
<p>The following example shows how to add a monitoring user on Node 2:</p>
<div class="highlight" data-prompt="mysql@pxc2>"><pre><span></span><code>mysql@pxc2&gt;<span class="w"> </span>CREATE<span class="w"> </span>USER<span class="w"> </span><span class="s1">&#39;proxysql&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span>IDENTIFIED<span class="w"> </span>WITH<span class="w"> </span>mysql_native_password<span class="w"> </span>by<span class="w"> </span><span class="s1">&#39;$3Kr$t&#39;</span><span class="p">;</span>
mysql@pxc2&gt;<span class="w"> </span>GRANT<span class="w"> </span>USAGE<span class="w"> </span>ON<span class="w"> </span>*.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;proxysql&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="p">;</span>
</code></pre></div>
<p>The following example shows how to configure this user on the ProxySQL node:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>UPDATE<span class="w"> </span>global_variables<span class="w"> </span>SET<span class="w"> </span><span class="nv">variable_value</span><span class="o">=</span><span class="s1">&#39;proxysql&#39;</span>
<span class="w">              </span>WHERE<span class="w"> </span><span class="nv">variable_name</span><span class="o">=</span><span class="s1">&#39;mysql-monitor_username&#39;</span><span class="p">;</span>
mysql@proxysql&gt;<span class="w"> </span>UPDATE<span class="w"> </span>global_variables<span class="w"> </span>SET<span class="w"> </span><span class="nv">variable_value</span><span class="o">=</span><span class="s1">&#39;ProxySQLPa55&#39;</span>
<span class="w">              </span>WHERE<span class="w"> </span><span class="nv">variable_name</span><span class="o">=</span><span class="s1">&#39;mysql-monitor_password&#39;</span><span class="p">;</span>
</code></pre></div>
<p>To load this configuration at runtime, issue a <code>LOAD</code> command.
To save these changes to disk
(ensuring that they persist after ProxySQL shuts down),
issue a <code>SAVE</code> command.</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>LOAD<span class="w"> </span>MYSQL<span class="w"> </span>VARIABLES<span class="w"> </span>TO<span class="w"> </span>RUNTIME<span class="p">;</span>
mysql@proxysql&gt;<span class="w"> </span>SAVE<span class="w"> </span>MYSQL<span class="w"> </span>VARIABLES<span class="w"> </span>TO<span class="w"> </span>DISK<span class="p">;</span>
</code></pre></div>
<p>To ensure that monitoring is enabled, check the monitoring logs:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>monitor.mysql_server_connect_log<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>time_start_us<span class="w"> </span>DESC<span class="w"> </span>LIMIT<span class="w"> </span><span class="m">6</span><span class="p">;</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+---------------+------+------------------+----------------------+---------------+
| hostname      | port | time_start_us    | connect_success_time | connect_error |
+---------------+------+------------------+----------------------+---------------+
| 192.168.70.71 | 3306 | 1469635762434625 | 1695                 | NULL          |
| 192.168.70.72 | 3306 | 1469635762434625 | 1779                 | NULL          |
| 192.168.70.73 | 3306 | 1469635762434625 | 1627                 | NULL          |
| 192.168.70.71 | 3306 | 1469635642434517 | 1557                 | NULL          |
| 192.168.70.72 | 3306 | 1469635642434517 | 2737                 | NULL          |
| 192.168.70.73 | 3306 | 1469635642434517 | 1447                 | NULL          |
+---------------+------+------------------+----------------------+---------------+
6 rows in set (0.00 sec)
</code></pre></div>
</details>
<div class="highlight" data-prompt="mysql>"><pre><span></span><code>mysql&gt;<span class="w"> </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>monitor.mysql_server_ping_log<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span>time_start_us<span class="w"> </span>DESC<span class="w"> </span>LIMIT<span class="w"> </span><span class="m">6</span><span class="p">;</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+---------------+------+------------------+-------------------+------------+
| hostname      | port | time_start_us    | ping_success_time | ping_error |
+---------------+------+------------------+-------------------+------------+
| 192.168.70.71 | 3306 | 1469635762416190 | 948               | NULL       |
| 192.168.70.72 | 3306 | 1469635762416190 | 803               | NULL       |
| 192.168.70.73 | 3306 | 1469635762416190 | 711               | NULL       |
| 192.168.70.71 | 3306 | 1469635702416062 | 783               | NULL       |
| 192.168.70.72 | 3306 | 1469635702416062 | 631               | NULL       |
| 192.168.70.73 | 3306 | 1469635702416062 | 542               | NULL       |
+---------------+------+------------------+-------------------+------------+
6 rows in set (0.00 sec)
</code></pre></div>
</details>
<p>The previous examples show that ProxySQL is able to connect
and ping the nodes you have added.</p>
<p>To enable monitoring of these nodes, load them at runtime:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>LOAD<span class="w"> </span>MYSQL<span class="w"> </span>SERVERS<span class="w"> </span>TO<span class="w"> </span>RUNTIME<span class="p">;</span>
</code></pre></div>
<h3 id="create-proxysql-client-user">Create ProxySQL client user<a class="headerlink" href="#create-proxysql-client-user" title="Permanent link">&para;</a></h3>
<p>ProxySQL must have users that can access backend nodes
to manage connections.</p>
<p>To add a user, insert credentials into <code>mysql_users</code> table:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>mysql_users<span class="w"> </span><span class="o">(</span>username,password<span class="o">)</span><span class="w"> </span>VALUES<span class="w"> </span><span class="o">(</span><span class="s1">&#39;sbuser&#39;</span>,<span class="s1">&#39;sbpass&#39;</span><span class="o">)</span><span class="p">;</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>Query OK, 1 row affected (0.00 sec)
</code></pre></div>
</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ProxySQL currently doesnt encrypt passwords.</p>
</div>
<p>Load the user into runtime space and save these changes to disk
(ensuring that they persist after ProxySQL shuts down):</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>LOAD<span class="w"> </span>MYSQL<span class="w"> </span>USERS<span class="w"> </span>TO<span class="w"> </span>RUNTIME<span class="p">;</span>
mysql@proxysql&gt;<span class="w"> </span>SAVE<span class="w"> </span>MYSQL<span class="w"> </span>USERS<span class="w"> </span>TO<span class="w"> </span>DISK<span class="p">;</span>
</code></pre></div>
<p>To confirm that the user has been set up correctly, you can try to log in as root:</p>
<div class="highlight" data-prompt="root@proxysql:~#"><pre><span></span><code>root@proxysql:~#<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>sbuser<span class="w"> </span>-psbpass<span class="w"> </span>-h<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>-P<span class="w"> </span><span class="m">6033</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 1491
Server version: 5.5.30 (ProxySQL)

Copyright (c) 2009-2020 Percona LLC and/or its affiliates
Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</code></pre></div>
</details>
<p>To provide read/write access to the cluster for ProxySQL,
add this user on one of the Percona XtraDB Cluster nodes:</p>
<div class="highlight" data-prompt="mysql@pxc3>"><pre><span></span><code>mysql@pxc3&gt;<span class="w"> </span>CREATE<span class="w"> </span>USER<span class="w"> </span><span class="s1">&#39;sbuser&#39;</span>@<span class="s1">&#39;192.168.70.74&#39;</span><span class="w"> </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;sbpass&#39;</span><span class="p">;</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>Query OK, 0 rows affected (0.01 sec)
</code></pre></div>
</details>
<div class="highlight" data-prompt="mysql@pxc3>"><pre><span></span><code>mysql@pxc3&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>*.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;sbuser&#39;</span>@<span class="s1">&#39;192.168.70.74&#39;</span><span class="p">;</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>Query OK, 0 rows affected (0.00 sec)
</code></pre></div>
</details>
<h3 id="test-cluster-with-sysbench">Test cluster with sysbench<a class="headerlink" href="#test-cluster-with-sysbench" title="Permanent link">&para;</a></h3>
<p>You can install <code>sysbench</code> from Percona software repositories:</p>
<ul>
<li>For Debian or Ubuntu:</li>
</ul>
<div class="highlight" data-prompt="root@proxysql:~#"><pre><span></span><code>root@proxysql:~#<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>sysbench
</code></pre></div>
<ul>
<li>For Red Hat Enterprise Linux or CentOS</li>
</ul>
<div class="highlight" data-prompt="root@proxysql:~#"><pre><span></span><code>root@proxysql:~#<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>sysbench
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>sysbench</code> requires ProxySQL client user credentials that you created in Creating ProxySQL Client User.</p>
</div>
<ol>
<li>
<p>Create the database that will be used for testing on one of the Percona XtraDB Cluster nodes:</p>
<div class="highlight" data-prompt="mysql@pxc1>"><pre><span></span><code>mysql@pxc1&gt;<span class="w"> </span>CREATE<span class="w"> </span>DATABASE<span class="w"> </span>sbtest<span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>Populate the table with data for the benchmark on the ProxySQL node:</p>
<div class="highlight" data-prompt="root@proxysql:~#"><pre><span></span><code>root@proxysql:~#<span class="w"> </span>sysbench<span class="w"> </span>--report-interval<span class="o">=</span><span class="m">5</span><span class="w"> </span>--num-threads<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
--num-requests<span class="o">=</span><span class="m">0</span><span class="w"> </span>--max-time<span class="o">=</span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
--test<span class="o">=</span>/usr/share/doc/sysbench/tests/db/oltp.lua<span class="w"> </span><span class="se">\</span>
--mysql-user<span class="o">=</span><span class="s1">&#39;sbuser&#39;</span><span class="w"> </span>--mysql-password<span class="o">=</span><span class="s1">&#39;sbpass&#39;</span><span class="w"> </span><span class="se">\</span>
--oltp-table-size<span class="o">=</span><span class="m">10000</span><span class="w"> </span>--mysql-host<span class="o">=</span><span class="m">127</span>.0.0.1<span class="w"> </span>--mysql-port<span class="o">=</span><span class="m">6033</span><span class="w"> </span><span class="se">\</span>
prepare
</code></pre></div>
</li>
<li>
<p>Run the benchmark on the ProxySQL node:</p>
<div class="highlight" data-prompt="root@proxysql:~#"><pre><span></span><code>root@proxysql:~#<span class="w"> </span>sysbench<span class="w"> </span>--report-interval<span class="o">=</span><span class="m">5</span><span class="w"> </span>--num-threads<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
--num-requests<span class="o">=</span><span class="m">0</span><span class="w"> </span>--max-time<span class="o">=</span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
--test<span class="o">=</span>/usr/share/doc/sysbench/tests/db/oltp.lua<span class="w"> </span><span class="se">\</span>
--mysql-user<span class="o">=</span><span class="s1">&#39;sbuser&#39;</span><span class="w"> </span>--mysql-password<span class="o">=</span><span class="s1">&#39;sbpass&#39;</span><span class="w"> </span><span class="se">\</span>
--oltp-table-size<span class="o">=</span><span class="m">10000</span><span class="w"> </span>--mysql-host<span class="o">=</span><span class="m">127</span>.0.0.1<span class="w"> </span>--mysql-port<span class="o">=</span><span class="m">6033</span><span class="w"> </span><span class="se">\</span>
run
</code></pre></div>
</li>
</ol>
<p>ProxySQL stores collected data in the <code>stats</code> schema:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>SHOW<span class="w"> </span>TABLES<span class="w"> </span>FROM<span class="w"> </span>stats<span class="p">;</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+--------------------------------+
| tables                         |
+--------------------------------+
| stats_mysql_query_rules        |
| stats_mysql_commands_counters  |
| stats_mysql_processlist        |
| stats_mysql_connection_pool    |
| stats_mysql_query_digest       |
| stats_mysql_query_digest_reset |
| stats_mysql_global             |
+--------------------------------+
</code></pre></div>
</details>
<p>For example, to see the number of commands that run on the cluster:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>stats_mysql_commands_counters<span class="p">;</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+---------------------------+---------------+-----------+-----------+-----------+---------+---------+----------+----------+-----------+-----------+--------+--------+---------+----------+
| Command                   | Total_Time_us | Total_cnt | cnt_100us | cnt_500us | cnt_1ms | cnt_5ms | cnt_10ms | cnt_50ms | cnt_100ms | cnt_500ms | cnt_1s | cnt_5s | cnt_10s | cnt_INFs |
+---------------------------+---------------+-----------+-----------+-----------+---------+---------+----------+----------+-----------+-----------+--------+--------+---------+----------+
| ALTER_TABLE               | 0             | 0         | 0         | 0         | 0       | 0       | 0        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
| ANALYZE_TABLE             | 0             | 0         | 0         | 0         | 0       | 0       | 0        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
| BEGIN                     | 2212625       | 3686      | 55        | 2162      | 899     | 569     | 1        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
| CHANGE_REPLICATION_SOURCE | 0             | 0         | 0         | 0         | 0       | 0       | 0        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
| COMMIT                    | 21522591      | 3628      | 0         | 0         | 0       | 1765    | 1590     | 272      | 1         | 0         | 0      | 0      | 0       | 0        |
| CREATE_DATABASE           | 0             | 0         | 0         | 0         | 0       | 0       | 0        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
| CREATE_INDEX              | 0             | 0         | 0         | 0         | 0       | 0       | 0        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
...
| DELETE                    | 2904130       | 3670      | 35        | 1546      | 1346    | 723     | 19       | 1        | 0         | 0         | 0      | 0      | 0       | 0        |
| DESCRIBE                  | 0             | 0         | 0         | 0         | 0       | 0       | 0        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
...
| INSERT                    | 19531649      | 3660      | 39        | 1588      | 1292    | 723     | 12       | 2        | 0         | 1         | 0      | 1      | 2       | 0        |
...
| SELECT                    | 35049794      | 51605     | 501       | 26180     | 16606   | 8241    | 70       | 3        | 4         | 0         | 0      | 0      | 0       | 0        |
| SELECT_FOR_UPDATE         | 0             | 0         | 0         | 0         | 0       | 0       | 0        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
...
| UPDATE                    | 6402302       | 7367      | 75        | 2503      | 3020    | 1743    | 23       | 3        | 0         | 0         | 0      | 0      | 0       | 0        |
| USE                       | 0             | 0         | 0         | 0         | 0       | 0       | 0        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
| SHOW                      | 19691         | 2         | 0         | 0         | 0       | 0       | 1        | 1        | 0         | 0         | 0      | 0      | 0       | 0        |
| UNKNOWN                   | 0             | 0         | 0         | 0         | 0       | 0       | 0        | 0        | 0         | 0         | 0      | 0      | 0       | 0        |
+---------------------------+---------------+-----------+-----------+-----------+---------+---------+----------+----------+-----------+-----------+--------+--------+---------+----------+
45 rows in set (0.00 sec)
</code></pre></div>
</details>
<h3 id="automatic-failover">Automatic failover<a class="headerlink" href="#automatic-failover" title="Permanent link">&para;</a></h3>
<p>ProxySQL will automatically detect if a node is not available
or not synced with the cluster.</p>
<p>You can check the status of all available nodes by running:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>SELECT<span class="w"> </span>hostgroup_id,hostname,port,status<span class="w"> </span>FROM<span class="w"> </span>runtime_mysql_servers<span class="p">;</span>
</code></pre></div>
<p>The following output shows the status of all available nodes:</p>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+--------------+---------------+------+--------+
| hostgroup_id | hostname      | port | status |
+--------------+---------------+------+--------+
| 0            | 192.168.70.71 | 3306 | ONLINE |
| 0            | 192.168.70.72 | 3306 | ONLINE |
| 0            | 192.168.70.73 | 3306 | ONLINE |
+--------------+---------------+------+--------+
3 rows in set (0.00 sec)
</code></pre></div>
</details>
<p>To test problem detection and fail-over mechanism, shut down Node 3:</p>
<div class="highlight" data-prompt="root@pxc3:~#"><pre><span></span><code>root@pxc3:~#<span class="w"> </span>service<span class="w"> </span>mysql<span class="w"> </span>stop
</code></pre></div>
<p>ProxySQL will detect that the node is down and update its status to
<code>OFFLINE_SOFT</code>:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>SELECT<span class="w"> </span>hostgroup_id,hostname,port,status<span class="w"> </span>FROM<span class="w"> </span>runtime_mysql_servers<span class="p">;</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+--------------+---------------+------+--------------+
| hostgroup_id | hostname      | port | status       |
+--------------+---------------+------+--------------+
| 0            | 192.168.70.71 | 3306 | ONLINE       |
| 0            | 192.168.70.72 | 3306 | ONLINE       |
| 0            | 192.168.70.73 | 3306 | OFFLINE_SOFT |
+--------------+---------------+------+--------------+
3 rows in set (0.00 sec)
</code></pre></div>
</details>
<p>Now start Node 3 again:</p>
<div class="highlight" data-prompt="root@pxc3:~#"><pre><span></span><code>root@pxc3:~#<span class="w"> </span>service<span class="w"> </span>mysql<span class="w"> </span>start
</code></pre></div>
<p>The script will detect the change and mark the node as
<code>ONLINE</code>:</p>
<div class="highlight" data-prompt="mysql@proxysql>"><pre><span></span><code>mysql@proxysql&gt;<span class="w"> </span>SELECT<span class="w"> </span>hostgroup_id,hostname,port,status<span class="w"> </span>FROM<span class="w"> </span>runtime_mysql_servers<span class="p">;</span>
</code></pre></div>
<details class="example">
<summary>Expected output</summary>
<div class="no-copy highlight"><pre><span></span><code>+--------------+---------------+------+--------+
| hostgroup_id | hostname      | port | status |
+--------------+---------------+------+--------+
| 0            | 192.168.70.71 | 3306 | ONLINE |
| 0            | 192.168.70.72 | 3306 | ONLINE |
| 0            | 192.168.70.73 | 3306 | ONLINE |
+--------------+---------------+------+--------+
3 rows in set (0.00 sec)
</code></pre></div>
</details>
<h2 id="assisted-maintenance-mode">Assisted maintenance mode<a class="headerlink" href="#assisted-maintenance-mode" title="Permanent link">&para;</a></h2>
<p>Usually, to take a node down for maintenance, you need to identify that node,
update its status in ProxySQL to <code>OFFLINE_SOFT</code>,
wait for ProxySQL to divert traffic from this node,
and then initiate the shutdown or perform maintenance tasks.
Percona XtraDB Cluster includes a special maintenance mode for nodes
that enables you to take a node down without adjusting ProxySQL manually.</p>
<p>Initiating <code>pxc_maint_mode=MAINTENANCE</code> does not disconnect existing connections. You must terminate these connections by either running your application code or forcing a re-connection. With a re-connection, the new connections are re-routed around the PXC node in <code>MAINTENANCE</code> mode.</p>
<p>Assisted maintenance mode is controlled via the <code>pxc_maint_mode</code> variable,
which is monitored by ProxySQL and can be set to one of the following values:</p>
<ul>
<li>
<p><code>DISABLED</code>: This value is the default state
that tells ProxySQL to route traffic to the node as usual.</p>
</li>
<li>
<p><code>SHUTDOWN</code>: This state is set automatically when you initiate node shutdown.</p>
<p>You may need to shut down a node when upgrading the OS, adding resources,
changing hardware parts, relocating the server, etc.</p>
<p>When you initiate node shutdown, Percona XtraDB Cluster does not send the signal immediately.
Intead, it changes the state to <code>pxc_maint_mode=SHUTDOWN</code>
and waits for a predefined period (10 seconds by default).
When ProxySQL detects that the mode is set to <code>SHUTDOWN</code>,
it changes the status of this node to <code>OFFLINE_SOFT</code>. This status stops creating new node connections.
After the transition period, long-running active transactions are aborted.</p>
</li>
<li>
<p><code>MAINTENANCE</code>: You can change to this state
if you need to perform maintenance on a node without shutting it down.</p>
<p>You may need to isolate the node for a specific time
so that it does not receive traffic from ProxySQL
while you resize the buffer pool, truncate the undo log,
defragment, or check disks, etc.</p>
<p>To do this, manually set <code>pxc_maint_mode=MAINTENANCE</code>.
Control is not returned to the user for a predefined period
(10 seconds by default). You can increase the transition period
using the <code>pxc_maint_transition_period</code> variable
to accommodate long-running transactions.
If the period is long enough for all transactions to finish,
there should be little disruption in the cluster workload. If you increase 
the transition period, the packaging script may determine the wait as a server stall.</p>
<p>When ProxySQL detects that the mode is set to <code>MAINTENANCE</code>,
it stops routing traffic to the node. During the transition period,
any existing connections continue, but ProxySQL avoids opening new connections and starting transactions.
Still, the user can open connections to monitor status.</p>
<p>Once control is returned, you can perform maintenance activity.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Data changes continue to be replicated across the cluster.</p>
</div>
<p>After you finish maintenance, set the mode back to <code>DISABLED</code>.
When ProxySQL detects this, it starts routing traffic to the node again.</p>
</li>
</ul>
<p><strong>Related sections</strong></p>
<p><a href="virt_sandbox.html#testing-env-proxysql-setting-up">Setting up a testing environment with ProxySQL</a></p>

                
<div class="md-relbar2__inner md-grid">
<div class="md-content">
  <article class="md-content__inner md-typeset" role="main">    
    <h3>Contact us </h3>
    <p>For free technical help, visit the Percona <a class="reference external" href="https://forums.percona.com/c/mysql-mariadb/percona-xtradb-cluster-8-x/37" target="_blank">Community Forum</a>.<br>
      <p>To report bugs or submit feature requests, open a <a class="reference external" href="https://jira.percona.com/projects/PXC/issues" target="_blank">JIRA</a> ticket.<br>
       <p>For paid <a class="reference external" href="https://www.percona.com/services/support"> support </a> and <a class="reference external" href="https://www.percona.com/services/managed-services"> managed </a> or <a class="reference external" href="https://www.percona.com/services/consulting">consulting services </a>, contact <a class="reference external" href="https://www.percona.com/about-percona/contact" target="_blank">Percona Sales</a>.</p>
 </article>
</div>
</div>

                <!-- Last update of source file -->
                
                  
                    <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2023-01-30
    
  </small>
</div>
                  
                
              
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
    <div class="md-copyright__highlight">
 <a href='https://percona.com' target='_blank'>Percona LLC and/or its affiliates, </a> &copy; 2023
    </div>
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["search.highlight", "navigation.top", "content.tabs.link", "content.code.copy", "navigation.tracking", "content.action.edit", "content.action.view"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
              
      <script src="../assets/javascripts/bundle.fc8c2696.min.js"></script>
      
        <script src="../js/version-select.js"></script>
      
        <script src="../js/promptremover.js"></script>
      
    

              <img src="https://tracking.g2crowd.com/attribution_tracking/conversions/1007137.gif?e=" width="1" height="1" />

              <noscript>
                <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K48FGP2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
              </noscript>
              
  </body>
</html>